{{ extends "layouts/main" }}

{{ block script() }}
<script>
    async function loadServices() {
        const apps = await fetchAPI('/apps');
        const container = document.getElementById('services-grid');
        container.innerHTML = '';

        apps.forEach(app => {
            const div = document.createElement('div');
            div.className = 'card bg-base-100 shadow-xl';
            div.innerHTML = `
                <div class="card-body">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="card-title">${app.name}</h2>
                        <div class="badge badge-success badge-outline">Active</div>
                    </div>
                    <p class="text-sm text-neutral-content">Service: <span class="font-mono text-base-content">${app.service_name}</span></p>
                    <p class="text-sm text-neutral-content mb-4">Logs: ${app.logs.length} files</p>
                    <div class="card-actions justify-end">
                        <button class="btn btn-primary w-full" onclick="restartService('${app.service_name}', this)">Restart Service</button>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    async function restartService(name, btn) {
        if (!confirm(`Restart ${name}?`)) return;
        
        const originalText = btn.innerText;
        btn.innerText = 'Restarting...';
        btn.disabled = true;

        try {
            await fetchAPI('/service/restart', {
                method: 'POST',
                body: JSON.stringify({ service_name: name })
            });
            alert('Restart command sent.');
        } catch (e) {
            alert('Error: ' + e.message);
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }

    loadServices();
</script>
{{ end }}

{{ block body() }}
<h2 class="text-3xl font-bold mb-6">Services</h2>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="services-grid">
    <!-- Services here -->
</div>
{{ end }}
